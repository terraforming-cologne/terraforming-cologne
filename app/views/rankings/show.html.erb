<h1><%= @tournament.name %> &ndash; <%= t(:ranking) %></h1>

<% if @current_round.blank? %>
  <h2><%= t(:no_rounds_finished_yet) %></h2>
<% else %>
  <div class="flex flex-col gap-8">
    <div class="flex gap-2">
      <% if @all_rounds.size > 1 %>
        <% @all_rounds.each do |round| %>
          <%= link_to round.board, [@tournament, :ranking, {round: round.number}], class: "link text-2xl font-bold" %>
        <% end %>
      <% end %>
    </div>

    <div class="-mx-(--page-padding) flex overflow-x-auto">
      <div class="grow px-(--page-padding)">
        <table class="w-full border-collapse px-(--page-padding) whitespace-nowrap">
          <thead>
            <tr>
              <th class="border-b border-gray-100 bg-gray-200 p-2 text-start"><%= t(:rank) %></th>
              <th class="border-b border-gray-100 bg-gray-200 p-2 text-start"><%= t(:name) %></th>
              <th class="border-b border-gray-100 bg-gray-200 p-2 text-start"><%= t(:points) %></th>
              <th class="border-b border-gray-100 bg-gray-200 p-2 text-start"><%= t(:opponent_points) %></th>
              <th class="border-b border-gray-100 bg-gray-200 p-2 text-start"><%= t(:points_per_generation) %></th>
              <% @rounds_up_to_current.find_each do |round| %>
                <th class="border-b border-gray-100 bg-gray-200 p-2 text-start"><%= round.board %></th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% @ranked_participations.each_with_index do |participation, index| %>
              <tr>
                <td class="border-b border-gray-100 p-2"><%= index + 1 %></td>
                <td class="border-b border-gray-100 p-2"><%= participation.user.name %></td>
                <% @ranking_criteria[@current_round][participation].each do |criterion| %>
                  <td class="border-b border-gray-100 p-2"><%= criterion %></td>
                <% end %>
                <% @rounds_up_to_current.each do |round| %>
                  <td class="border-b border-gray-100 p-2"><%= participation.rank_in(round)&.ordinalize || "-" %></td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% end %>
